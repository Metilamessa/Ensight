(()=>{var e={};e.id=636,e.ids=[636],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},38417:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var s=(0,r(6445).A)("outline","bookmark","IconBookmark",[["path",{d:"M18 7v14l-6 -4l-6 4v-14a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4z",key:"svg-0"}]])},45114:(e,t,r)=>{Promise.resolve().then(r.bind(r,94289))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75758:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/met/2025 Projects/ENSIGHT/frontend/src/app/profile/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/met/2025 Projects/ENSIGHT/frontend/src/app/profile/page.tsx","default")},79551:e=>{"use strict";e.exports=require("url")},83237:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var s=(0,r(6445).A)("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]])},89129:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var s=r(65239),a=r(48088),o=r(88170),i=r.n(o),l=r(30893),n={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);r.d(t,n);let d={children:["",{children:["profile",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,75758)),"/home/met/2025 Projects/ENSIGHT/frontend/src/app/profile/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,48235)),"/home/met/2025 Projects/ENSIGHT/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,54413)),"/home/met/2025 Projects/ENSIGHT/frontend/src/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/met/2025 Projects/ENSIGHT/frontend/src/app/profile/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/profile/page",pathname:"/profile",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},94289:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>M});var s=r(60687),a=r(43210),o=r(42176),i=r(6099),l=r(23376),n=r(32125),d=r(32127),c=r(10507),u=r(75891),m=r(90910),p=r(38417),h=r(6445),f=(0,h.A)("outline","history","IconHistory",[["path",{d:"M12 8l0 4l2 2",key:"svg-0"}],["path",{d:"M3.05 11a9 9 0 1 1 .5 4m-.5 5v-5h5",key:"svg-1"}]]),x=r(16189),g=r(15321),v=r(16537),b=r(98799),j=(0,h.A)("outline","key","IconKey",[["path",{d:"M16.555 3.843l3.602 3.602a2.877 2.877 0 0 1 0 4.069l-2.643 2.643a2.877 2.877 0 0 1 -4.069 0l-.301 -.301l-6.558 6.558a2 2 0 0 1 -1.239 .578l-.175 .008h-1.172a1 1 0 0 1 -.993 -.883l-.007 -.117v-1.172a2 2 0 0 1 .467 -1.284l.119 -.13l.414 -.414h2v-2h2v-2l2.144 -2.144l-.301 -.301a2.877 2.877 0 0 1 0 -4.069l2.643 -2.643a2.877 2.877 0 0 1 4.069 0z",key:"svg-0"}],["path",{d:"M15 9h.01",key:"svg-1"}]]);let y=({settings:e,handleSettingChange:t,onPasswordReset:r})=>(0,s.jsxs)("div",{className:"p-6 border rounded-lg shadow-sm bg-surface border-border",children:[(0,s.jsx)(l.Title,{order:3,className:"mb-4 text-blue",children:"Personalization Settings"}),(0,s.jsx)(v.Text,{className:"mb-6 text-muted",children:"Adjust how we personalize your content"}),[{title:"Enable Personalization",description:"Use your reading history to recommend relevant content",value:e.enablePersonalization,key:"enablePersonalization"},{title:"Track Reading Progress",description:"Save article progress to resume later",value:e.trackReadingProgress,key:"trackReadingProgress"},{title:"Content Update Notifications",description:"Notify you when new relevant content is published",value:e.contentUpdateNotifications,key:"contentUpdateNotifications"}].map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between mb-5 last:mb-0",children:[(0,s.jsxs)("div",{className:"flex-1 pr-4",children:[(0,s.jsx)(v.Text,{className:"font-medium text-blue",children:e.title}),(0,s.jsx)(v.Text,{className:"text-sm text-muted",children:e.description})]}),(0,s.jsx)(b.Switch,{checked:e.value,onChange:()=>t(e.key),color:"var(--color-blue)",size:"md"})]},e.key)),r&&(0,s.jsx)("div",{className:"pt-4 mt-4 border-t border-border",children:(0,s.jsx)(c.Button,{leftSection:(0,s.jsx)(j,{size:16}),variant:"outline",color:"blue",onClick:r,fullWidth:!0,children:"Change Password"})})]});var N=r(99445),w=r(61279),k=r(95603);let P=["Business","Economy","Technology","Finance"],S=({selectedTopics:e,handleTopicToggle:t})=>(0,s.jsxs)("div",{className:"p-6 border rounded-lg shadow-sm bg-surface border-border",children:[(0,s.jsx)(l.Title,{order:3,className:"mb-4 text-blue",children:"Topic Preferences"}),(0,s.jsx)(v.Text,{className:"mb-6 text-muted",children:"Select topics you're interested in"}),(0,s.jsx)(N.Group,{gap:"xs",className:"flex flex-wrap gap-2 my-6",children:P.map(r=>{let a=e.includes(r);return(0,s.jsx)(w.Badge,{variant:a?"filled":"light",color:a?"blue":"gray",onClick:()=>t(r),className:"px-3 py-1 cursor-pointer",leftSection:a?(0,s.jsx)(k.A,{size:14}):null,children:r},r)})}),(0,s.jsx)(v.Text,{className:"mt-5 text-sm text-muted",children:"Click topics to add or remove them from your interests"})]});var T=r(68704),C=r(40859),z=r(3179),E=r(83237);let _=({profile:e,userId:t})=>{let r=(0,x.useRouter)(),[o,l]=(0,a.useState)([]),[n,d]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null),[p,h]=(0,a.useState)(null),f=t||void 0;(0,a.useEffect)(()=>{if(!f)return void d(!1);(async()=>{try{let e=localStorage.getItem("token");if(!e){m("Please login to view saved articles"),d(!1);return}let t=await fetch(`/api/profile/${f}/saved_articles`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){let e=await t.json();throw Error(e.message||"Failed to fetch saved articles")}let r=await t.json();l(r||[])}catch(e){m(e instanceof Error?e.message:"Failed to load saved articles")}finally{d(!1)}})()},[f]);let g=async e=>{if(f){h(e);try{let t=localStorage.getItem("token");if(!t)throw Error("Please login to remove articles");let r=await fetch(`/api/profile/${f}/saved_articles/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to remove article")}l(t=>t.filter(t=>t.id!==e))}catch(e){m(e instanceof Error?e.message:"Failed to remove article"),setTimeout(()=>m(null),3e3)}finally{h(null)}}},b=e=>{let t=e.href||`/${e.category}/${e.subcategory}/${e.slug}`;r.push(t)};return n?(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)(i.Loader,{})}):u?(0,s.jsx)("div",{className:"p-4 border border-red-300 rounded-lg bg-red-50",children:(0,s.jsx)(v.Text,{className:"text-red-600",children:u})}):0===o.length?(0,s.jsxs)("div",{className:"p-8 text-center border rounded-lg bg-surface border-border",children:[(0,s.jsx)(v.Text,{className:"mb-2 text-lg font-medium text-secondary",children:"No saved articles yet"}),(0,s.jsx)(v.Text,{className:"text-muted",children:"Articles you save will appear here for easy access later."})]}):(0,s.jsx)(T.Stack,{gap:"md",children:o.map(e=>(0,s.jsx)(C.Card,{shadow:"sm",padding:"lg",radius:"md",withBorder:!0,className:"cursor-pointer hover:shadow-md transition-shadow",children:(0,s.jsxs)(N.Group,{gap:"md",align:"flex-start",children:[e.image&&(0,s.jsx)(z.Image,{src:"string"==typeof e.image?e.image:URL.createObjectURL(e.image),alt:e.title,width:120,height:80,fit:"cover",radius:"sm",onClick:()=>b(e)}),(0,s.jsxs)(T.Stack,{gap:"xs",style:{flex:1},children:[(0,s.jsx)(v.Text,{fw:600,size:"lg",onClick:()=>b(e),className:"cursor-pointer hover:text-primary-accent transition-colors",children:e.title}),e.description&&(0,s.jsx)(v.Text,{size:"sm",c:"dimmed",lineClamp:2,children:e.description}),(0,s.jsxs)(N.Group,{gap:"sm",mt:"xs",children:[(0,s.jsxs)(v.Text,{size:"xs",c:"dimmed",children:[e.category,e.subcategory&&` â€¢ ${e.subcategory}`]}),e.readTime&&(0,s.jsx)(v.Text,{size:"xs",c:"dimmed",children:e.readTime})]})]}),(0,s.jsx)(c.Button,{variant:"subtle",color:"red",size:"sm",onClick:()=>g(e.id),loading:p===e.id,leftSection:(0,s.jsx)(E.A,{size:16}),children:"Remove"})]})},e.id))})},I=({profile:e})=>(0,s.jsx)(v.Text,{className:"text-muted",children:e?.readingHistory?.length?"Your reading history appears here.":"No reading history available."});var A=r(70045),R=r(91541),G=r(18002);let B=({opened:e,onClose:t})=>{let[r,o]=(0,a.useState)(""),[i,l]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[m,p]=(0,a.useState)(!1),[h,f]=(0,a.useState)(null),[x,g]=(0,a.useState)(!1),v=async e=>{if(e.preventDefault(),f(null),g(!1),!r||!i||!d)return void f("All fields are required");if(i!==d)return void f("New passwords do not match");if(i.length<6)return void f("Password must be at least 6 characters long");p(!0);try{let e=localStorage.getItem("token");if(!e)throw Error("Please login to reset password");let s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({current_password:r,new_password:i})});if(!s.ok){let e=await s.json();throw Error(e.message||e.detail||"Failed to reset password")}g(!0),o(""),l(""),u(""),setTimeout(()=>{g(!1),t()},2e3)}catch(e){f(e instanceof Error?e.message:"Failed to reset password")}finally{p(!1)}};return(0,s.jsxs)(A.Modal,{opened:e,onClose:t,title:"Reset Password",centered:!0,size:"md",children:[h&&(0,s.jsx)(n.Notification,{color:"red",title:"Error",onClose:()=>f(null),className:"mb-4",children:h}),x&&(0,s.jsx)(n.Notification,{color:"green",title:"Success",className:"mb-4",children:"Password reset successfully!"}),(0,s.jsxs)("form",{onSubmit:v,children:[(0,s.jsx)(R.TextInput,{label:"Current Password",type:"password",placeholder:"Enter your current password",value:r,onChange:e=>o(e.currentTarget.value),required:!0,mb:"md",disabled:m}),(0,s.jsx)(G.PasswordInput,{label:"New Password",placeholder:"Enter your new password",value:i,onChange:e=>l(e.currentTarget.value),required:!0,mb:"md",disabled:m,minLength:6}),(0,s.jsx)(G.PasswordInput,{label:"Confirm New Password",placeholder:"Confirm your new password",value:d,onChange:e=>u(e.currentTarget.value),required:!0,mb:"md",disabled:m,minLength:6}),(0,s.jsxs)(N.Group,{justify:"flex-end",mt:"xl",children:[(0,s.jsx)(c.Button,{variant:"outline",onClick:t,disabled:m,children:"Cancel"}),(0,s.jsx)(c.Button,{type:"submit",loading:m,disabled:x,children:"Reset Password"})]})]})]})},F=[{value:"preferences",label:"Preferences",icon:(0,s.jsx)(m.A,{size:16,className:"inline-block mr-2 -mt-1"})},{value:"saved",label:"Saved Articles",icon:(0,s.jsx)(p.A,{size:16,className:"inline-block mr-2 -mt-1"})},{value:"history",label:"Reading History",icon:(0,s.jsx)(f,{size:16,className:"inline-block mr-2 -mt-1"})}],M=()=>{let e=(0,x.useRouter)(),t=(0,g.n)(e=>e.setLoggedIn),[r,m]=(0,a.useState)(null),[p,h]=(0,a.useState)(!0),[f,v]=(0,a.useState)({enablePersonalization:!1,trackReadingProgress:!1,contentUpdateNotifications:!1}),[b,j]=(0,a.useState)([]),[N,w]=(0,a.useState)(!1),[k,P]=(0,a.useState)(!1),[T,C]=(0,a.useState)(null),[z,E]=(0,a.useState)(null),[A,R]=(0,a.useState)(null),[G,M]=(0,a.useState)(!1),[$,U]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{try{let t=localStorage.getItem("token");if(!t){h(!1),e.push("/login");return}let r=null,s=localStorage.getItem("user");if(s)try{let e=JSON.parse(s);r=e?.id||e?.user_id||null}catch(e){console.error("Failed to parse stored user",e)}if(!r)try{let e=await fetch("/api/auth/me",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(e.ok){let t=await e.json();r=t?.id||t?.user_id||null,t&&localStorage.setItem("user",JSON.stringify(t))}}catch(e){console.error("Failed to fetch current user",e)}if(!r){h(!1),m(null);return}U(r);let a=await fetch(`/api/profile/${r}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),o=await a.json();if(!a.ok){m(null),console.error("Failed to fetch profile:",o.message||"Profile not found");return}m(o),v({enablePersonalization:o?.enable_personalization||o?.enablePersonalization||!1,trackReadingProgress:o?.track_reading_progress||o?.trackReadingProgress||!1,contentUpdateNotifications:o?.content_update_notifications||o?.contentUpdateNotifications||!1}),j(Array.isArray(o?.topics)?o.topics:"string"==typeof o?.topics?JSON.parse(o.topics):[]),R(o?.profile_image||o?.profileImage||null)}catch(e){m(null),console.error("Failed to fetch profile",e)}finally{h(!1)}})()},[e]);let q=async()=>{if(!$)return void C("User ID not found");w(!0),C(null),P(!1);try{let e=new FormData;void 0!==f.enablePersonalization&&e.append("enable_personalization",String(f.enablePersonalization)),void 0!==f.trackReadingProgress&&e.append("track_reading_progress",String(f.trackReadingProgress)),void 0!==f.contentUpdateNotifications&&e.append("content_update_notifications",String(f.contentUpdateNotifications)),b.length>0&&e.append("topics",JSON.stringify(b)),z&&e.append("profile_image",z);let t=await fetch(`/api/profile/${$}`,{method:"PATCH",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:e});if(!t.ok){let e=await t.json();throw Error(e.message||e.detail||"Failed to update profile")}let r=await t.json();m(r),j(r?.topics||[]),R(r?.profileImage||null),E(null),P(!0),setTimeout(()=>P(!1),3e3)}catch(e){C(e instanceof Error?e.message:"Failed to update profile"),setTimeout(()=>C(null),3e3)}finally{w(!1)}},L=()=>{localStorage.removeItem("user"),localStorage.removeItem("token"),t(!1),e.push("/login")};return p?(0,s.jsx)(o.Container,{className:"flex items-center justify-center min-h-screen p-6",children:(0,s.jsx)(i.Loader,{})}):(0,s.jsx)(o.Container,{className:"min-h-screen p-6",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l.Title,{order:1,className:"mb-2 text-blue",children:["Welcome, ",r?.firstName||r?.firstName||""," ",r?.lastName||r?.lastName||""," ",(0,s.jsxs)("span",{className:"mb-6 text-sm text-muted",children:[" (",r?.email,")"]})]}),k&&(0,s.jsx)(n.Notification,{title:"Success",color:"green",onClose:()=>P(!1),className:"mb-4",children:"Profile updated successfully!"}),T&&(0,s.jsx)(n.Notification,{title:"Error",color:"red",onClose:()=>C(null),className:"mb-4",children:T}),(0,s.jsxs)(d.Tabs,{defaultValue:"preferences",classNames:{list:"flex gap-3 mb-6 border-b border-border"},children:[(0,s.jsx)(d.Tabs.List,{children:F.map(e=>(0,s.jsx)(d.Tabs.Tab,{value:e.value,leftSection:e.icon,className:"custom-tab-style",children:e.label},e.value))}),(0,s.jsxs)(d.Tabs.Panel,{value:"preferences",className:"mt-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("label",{className:"block mb-2 text-sm font-medium text-blue",children:"Profile Image"}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[A&&(0,s.jsx)("img",{src:A,alt:"Profile preview",className:"object-cover w-20 h-20 rounded-full border-2 border-border"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){E(t);let e=new FileReader;e.onloadend=()=>{R(e.result)},e.readAsDataURL(t)}},className:"text-sm text-secondary file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-accent file:text-white hover:file:bg-primary-accent/80"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2",children:[(0,s.jsx)(y,{settings:f,handleSettingChange:e=>{v(t=>({...t,[e]:!t[e]}))},onPasswordReset:()=>M(!0)}),(0,s.jsx)(S,{selectedTopics:b,handleTopicToggle:e=>{j(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])}})]}),(0,s.jsxs)("div",{className:"flex mt-6 space-x-7",children:[(0,s.jsx)(c.Button,{onClick:q,loading:N,color:"blue",size:"md",children:"Update Preferences"}),(0,s.jsx)(c.Button,{color:"red",variant:"outline",onClick:L,size:"md",children:"Logout"})]})]}),(0,s.jsx)(d.Tabs.Panel,{value:"saved",className:"mt-6",children:(0,s.jsx)(_,{profile:r,userId:$})}),(0,s.jsx)(d.Tabs.Panel,{value:"history",className:"mt-6",children:(0,s.jsx)(I,{profile:r})})]}),(0,s.jsx)(B,{opened:G,onClose:()=>M(!1)})]}):(0,s.jsxs)(u.Box,{className:"flex flex-col items-center justify-center p-6",children:[(0,s.jsx)(l.Title,{order:2,className:"text-red-600",children:"Profile not found"}),(0,s.jsx)(c.Button,{variant:"outline",color:"blue",className:"mt-4",onClick:()=>e.push("/"),children:"Go to Home"}),(0,s.jsx)(c.Button,{color:"red",variant:"outline",onClick:L,size:"md",mt:10,children:"Logout"})]})})}},95603:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var s=(0,r(6445).A)("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]])},98258:(e,t,r)=>{Promise.resolve().then(r.bind(r,75758))}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,454,371],()=>r(89129));module.exports=s})();